# ðŸ”Œ API Reference - Tin UI V3

Complete REST API documentation for backend services.

---

## Base URL

```
Production: https://tin-ui-v3.vercel.app/api
Development: http://localhost:5000/api
```

---

## Authentication

All requests require authentication via Supabase Auth.

**Headers:**
```
Authorization: Bearer YOUR_SUPABASE_JWT_TOKEN
Content-Type: application/json
```

---

## Projects API

### Create Project
```http
POST /api/projects
```

**Request Body:**
```json
{
  "name": "My Dating Photos",
  "category": "dating",
  "userId": "user-uuid"
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "id": "project-uuid",
    "name": "My Dating Photos",
    "category": "dating",
    "user_id": "user-uuid",
    "created_at": "2025-12-08T10:00:00Z"
  }
}
```

### Get All Projects
```http
GET /api/projects?userId=USER_UUID
```

### Get Project by ID
```http
GET /api/projects/:id
```

---

## Sessions API

### Create Session
```http
POST /api/sessions
```

**Request Body:**
```json
{
  "projectId": "project-uuid",
  "userId": "user-uuid",
  "name": "Winter Photos Session",
  "useDynamicParameters": false
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "session": {
      "id": "session-uuid",
      "project_id": "project-uuid",
      "name": "Winter Photos Session",
      "use_dynamic_parameters": false,
      "created_at": "2025-12-08T10:00:00Z"
    },
    "parameters": { /* 11-14 parameter categories */ },
    "weights": { /* initialized weights */ }
  }
}
```

### Get Sessions by Project
```http
GET /api/sessions?projectId=PROJECT_UUID
```

### Get Session Details
```http
GET /api/sessions/:id
```

---

## Generation API

### Generate Content
```http
POST /api/generation/generate
```

**Request Body (Text-to-Image):**
```json
{
  "sessionId": "session-uuid",
  "projectId": "project-uuid",
  "userId": "user-uuid",
  "userPrompt": "A beautiful sunset over mountains",
  "count": 4,
  "model": "seedream-4"
}
```

**Request Body (With Vision AI):**
```json
{
  "sessionId": "session-uuid",
  "projectId": "project-uuid",
  "userId": "user-uuid",
  "userPrompt": "Generated by Vision AI...",
  "count": 4,
  "model": "seedream-4",
  "mode": "ad-replicator",
  "modeInputs": {
    "reference_images": ["data:image/jpeg;base64,..."],
    "visionCategory": "automotive_insurance",
    "visionAnalysis": {
      "analysis": {
        "niche": "automotive_insurance",
        "photoDescriptions": ["Photo 1: Blue sedan..."],
        "styleAnalysis": { /* ... */ }
      }
    }
  }
}
```

**Response:**
```json
{
  "success": true,
  "data": [
    {
      "id": "content-uuid",
      "session_id": "session-uuid",
      "url": "https://storage.url/image.jpg",
      "prompt": "Generated prompt text",
      "parameters": { /* selected parameters */ },
      "model": "seedream-4",
      "created_at": "2025-12-08T10:00:00Z"
    }
  ]
}
```

### Rate Content
```http
POST /api/generation/rate
```

**Request Body:**
```json
{
  "contentId": "content-uuid",
  "rating": 4
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "content": { /* updated content */ },
    "weightsUpdated": 12
  }
}
```

### Get Unrated Content Count
```http
GET /api/generation/unrated/:sessionId
```

---

## Vision AI API

### Analyze Photos
```http
POST /api/vision/analyze
```

**Request Body:**
```json
{
  "photos": [
    {
      "index": 0,
      "dataUrl": "data:image/jpeg;base64,...",
      "comment": "Optional comment"
    }
  ],
  "mode": "ad-replicator",
  "agentType": "general",
  "userInstructions": "Focus on automotive theme"
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "prompt": "Detailed generated prompt (200-400 words)",
    "analysis": {
      "niche": "automotive_insurance",
      "targetAudience": "young professionals 25-40",
      "platform": "Instagram",
      "styleAnalysis": {
        "visualStyle": "modern professional",
        "colorPalette": "corporate blue and white",
        "composition": "centered hero",
        "mood": "trust and security"
      },
      "photoDescriptions": [
        "Photo 1: Blue 2024 sedan, 3/4 angle..."
      ]
    },
    "finalCategory": "automotive_insurance",
    "imageCount": 3,
    "model": "gpt-4o"
  }
}
```

---

## Weights API

### Get Weight History
```http
GET /api/sessions/:id/weight-history
```

**Response:**
```json
{
  "success": true,
  "data": {
    "initialWeights": [
      { "parameter": "lighting.golden_hour", "weight": 100 }
    ],
    "currentWeights": [
      { "parameter": "lighting.golden_hour", "weight": 130 }
    ],
    "changes": [
      {
        "parameter": "lighting.golden_hour",
        "initial": 100,
        "current": 130,
        "change": +30,
        "percentChange": +30
      }
    ]
  }
}
```

---

## Error Responses

All errors follow this format:

```json
{
  "success": false,
  "error": "Error message description"
}
```

**Common Status Codes:**
- `400` - Bad Request (missing/invalid parameters)
- `401` - Unauthorized (missing/invalid auth token)
- `404` - Not Found (resource doesn't exist)
- `500` - Internal Server Error (server-side issue)

---

## Rate Limits

- No explicit rate limits currently
- Recommended: Max 10 requests/second per user
- Large batch operations: Use pagination

---

## Webhooks

Not implemented yet.

---

**Last Updated:** 2025-12-08
